<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Vesting Base</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; background: #f0f2f5; color: #333; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; font-size: 1.5rem; text-align: center; margin-bottom: 20px;}
        .input-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; font-size: 0.9rem; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: monospace; font-size: 1rem; }
        button { background: #0052ff; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; transition: background 0.2s; }
        button:hover { background: #0040c9; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        
        .result-box { margin-top: 25px; border-top: 1px solid #eee; padding-top: 20px; display: none; }
        .row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95rem; }
        .highlight { background: #e6f0ff; color: #0052ff; padding: 15px; border-radius: 8px; font-weight: bold; font-size: 1.1em; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .error { color: #d93025; background: #fce8e6; padding: 10px; border-radius: 6px; margin-top: 15px; display: none; text-align: center; }
        .loading { text-align: center; color: #666; font-style: italic; margin-top: 10px; display: none; }
        
        footer { text-align: center; margin-top: 30px; font-size: 0.8rem; color: #888; }
        a { color: #0052ff; text-decoration: none; }
    </style>
</head>
<body>

<div class="card">
    <h1>üîç Vesting Checker (Base)</h1>
    
    <div class="input-group">
        <label for="addressInput">Adresse du Wallet :</label>
        <input type="text" id="addressInput" placeholder="0x..." spellcheck="false">
    </div>

    <button id="checkBtn" onclick="checkBalance()">V√©rifier le solde</button>
    
    <div id="loading" class="loading">Lecture de la blockchain...</div>
    <div id="error" class="error"></div>

    <div id="result" class="result-box">
        <div class="row"><span>Solde Total (Wallet) :</span> <strong id="total">---</strong></div>
        <div class="row"><span>üîí Encore Bloqu√© :</span> <strong id="locked">---</strong></div>
        <div class="highlight">
            <span>‚úÖ DISPONIBLE :</span> 
            <span id="available">---</span>
        </div>
    </div>
</div>

<footer>
    Donn√©es en direct de la blockchain Base.<br>
    Token Contract: <a href="https://basescan.org/address/0xb372dc09d8d84e1246760ee9d279e504a89f5684" target="_blank">0xb372...5684</a>
</footer>

<!-- Script Module -->
<script type="module">
    import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";

    // --- CONFIGURATION ---
    const RPC_URL = "https://mainnet.base.org";
    const TOKEN_ADDRESS = "0xb372dc09d8d84e1246760ee9d279e504a89f5684";
    const ABI = [
        "function balanceOf(address owner) view returns (uint256)",
        "function decimals() view returns (uint8)",
        "function getVestingTokenAmount(address userAddress) view returns (uint256)"
    ];

    // Fonction principale attach√©e √† la fen√™tre pour √™tre accessible par le bouton HTML
    window.checkBalance = async function() {
        const addressInput = document.getElementById('addressInput');
        const resultDiv = document.getElementById('result');
        const errorDiv = document.getElementById('error');
        const loadingDiv = document.getElementById('loading');
        const btn = document.getElementById('checkBtn');

        const address = addressInput.value.trim();
        
        // Reset de l'interface
        errorDiv.style.display = 'none';
        resultDiv.style.display = 'none';
        
        if(!ethers.isAddress(address)) {
            errorDiv.innerText = "‚ùå Adresse invalide. V√©rifiez le format (0x...).";
            errorDiv.style.display = 'block';
            return;
        }

        // UI Loading state
        loadingDiv.style.display = 'block';
        btn.disabled = true;

        try {
            const provider = new ethers.JsonRpcProvider(RPC_URL);
            const contract = new ethers.Contract(TOKEN_ADDRESS, ABI, provider);

            // Appels parall√®les (Balance + Vesting + D√©cimales)
            const [total, locked, decimals] = await Promise.all([
                contract.balanceOf(address),
                contract.getVestingTokenAmount(address),
                contract.decimals()
            ]);

            // Calcul : Total - Bloqu√© = Disponible
            const available = total - locked;

            // Formatage
            document.getElementById('total').innerText = formatNumber(ethers.formatUnits(total, decimals));
            document.getElementById('locked').innerText = formatNumber(ethers.formatUnits(locked, decimals));
            document.getElementById('available').innerText = formatNumber(ethers.formatUnits(available, decimals)) + " Tokens";

            resultDiv.style.display = 'block';

        } catch (err) {
            console.error(err);
            errorDiv.innerText = "‚ö†Ô∏è Erreur de connexion RPC. R√©essayez.";
            errorDiv.style.display = 'block';
        } finally {
            loadingDiv.style.display = 'none';
            btn.disabled = false;
        }
    }

    // Petit utilitaire pour mettre des virgules (ex: 1,000.50)
    function formatNumber(numStr) {
        return parseFloat(numStr).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 4 });
    }

    // --- AUTO-RUN SI URL CONTIENT ?addr= ---
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const addrParam = urlParams.get('addr');

        if (addrParam) {
            document.getElementById('addressInput').value = addrParam;
            // On lance la v√©rification automatiquement
            checkBalance();
        }
    }
</script>

</body>
</html>
