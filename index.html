<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>V√©rificateur de Solde Transf√©rable</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; background: #f0f2f5; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #333; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { background: #0052ff; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; }
        button:hover { background: #0040c9; }
        .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none; }
        .row { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .highlight { color: #0052ff; font-weight: bold; font-size: 1.2em; border-top: 1px solid #eee; padding-top: 10px; margin-top: 10px; }
        .error { color: red; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>üîì Mon Solde Transf√©rable</h2>
    <p>Entrez votre adresse pour voir ce qui est d√©bloqu√©.</p>
    
    <input type="text" id="addressInput" placeholder="0x..." value="">
    <button onclick="checkBalance()">V√©rifier le solde</button>
    
    <div id="error" class="error"></div>

    <div id="result" class="result">
        <div class="row"><span>Solde Total (Wallet):</span> <strong id="total">---</strong></div>
        <div class="row"><span>Encore Bloqu√© (Vesting):</span> <strong id="locked">---</strong></div>
        <div class="row highlight"><span>‚úÖ DISPONIBLE :</span> <span id="available">---</span></div>
    </div>
</div>

<!-- Import de la librairie Ethers.js directement depuis le web -->
<script type="module">
    import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";

    // Configuration
    const RPC_URL = "https://mainnet.base.org";
    const TOKEN_ADDRESS = "0xb372dc09d8d84e1246760ee9d279e504a89f5684";
    const ABI = [
        "function balanceOf(address owner) view returns (uint256)",
        "function decimals() view returns (uint8)",
        "function getVestingTokenAmount(address userAddress) view returns (uint256)"
    ];

    window.checkBalance = async function() {
        const address = document.getElementById('addressInput').value;
        const resultDiv = document.getElementById('result');
        const errorDiv = document.getElementById('error');
        
        if(!ethers.isAddress(address)) {
            errorDiv.innerText = "Adresse invalide";
            errorDiv.style.display = 'block';
            return;
        }

        errorDiv.style.display = 'none';
        resultDiv.style.opacity = '0.5';

        try {
            const provider = new ethers.JsonRpcProvider(RPC_URL);
            const contract = new ethers.Contract(TOKEN_ADDRESS, ABI, provider);

            // Appels parall√®les pour aller plus vite
            const [total, locked, decimals] = await Promise.all([
                contract.balanceOf(address),
                contract.getVestingTokenAmount(address),
                contract.decimals()
            ]);

            const available = total - locked;

            document.getElementById('total').innerText = parseFloat(ethers.formatUnits(total, decimals)).toFixed(2);
            document.getElementById('locked').innerText = parseFloat(ethers.formatUnits(locked, decimals)).toFixed(2);
            document.getElementById('available').innerText = parseFloat(ethers.formatUnits(available, decimals)).toFixed(4) + " Tokens";

            resultDiv.style.display = 'block';
            resultDiv.style.opacity = '1';

        } catch (err) {
            console.error(err);
            errorDiv.innerText = "Erreur de connexion √† la blockchain.";
            errorDiv.style.display = 'block';
        }
    }
</script>

</body>
</html>